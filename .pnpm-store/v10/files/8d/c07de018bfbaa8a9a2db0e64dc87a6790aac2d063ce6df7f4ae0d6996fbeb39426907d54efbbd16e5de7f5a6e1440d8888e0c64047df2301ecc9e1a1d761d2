'use strict';

var utils = require('@typescript-eslint/utils');
require('@typescript-eslint/utils/ast-utils');
var blockSpacing = require('./block-spacing.js');
require('graphemer');
require('@typescript-eslint/type-utils');

const baseRule = blockSpacing.getESLintCoreRule("semi");
var semi = blockSpacing.createRule({
  name: "semi",
  meta: {
    type: "layout",
    docs: {
      description: "Require or disallow semicolons instead of ASI",
      // too opinionated to be recommended
      extendsBaseRule: true
    },
    fixable: "code",
    hasSuggestions: baseRule.meta.hasSuggestions,
    schema: baseRule.meta.schema,
    messages: baseRule.meta.messages
  },
  defaultOptions: [
    "always",
    {
      omitLastInOneLineBlock: false,
      beforeStatementContinuationChars: "any"
    }
  ],
  create(context) {
    const rules = baseRule.create(context);
    const checkForSemicolon = rules.ExpressionStatement;
    const nodesToCheck = [
      utils.AST_NODE_TYPES.PropertyDefinition,
      utils.AST_NODE_TYPES.TSAbstractPropertyDefinition,
      utils.AST_NODE_TYPES.TSDeclareFunction,
      utils.AST_NODE_TYPES.TSExportAssignment,
      utils.AST_NODE_TYPES.TSImportEqualsDeclaration,
      utils.AST_NODE_TYPES.TSTypeAliasDeclaration,
      utils.AST_NODE_TYPES.TSEmptyBodyFunctionExpression
    ].reduce((acc, node) => {
      acc[node] = checkForSemicolon;
      return acc;
    }, {});
    return {
      ...rules,
      ...nodesToCheck,
      ExportDefaultDeclaration(node) {
        if (node.declaration.type !== utils.AST_NODE_TYPES.TSInterfaceDeclaration)
          rules.ExportDefaultDeclaration(node);
      }
    };
  }
});

exports.semi = semi;
